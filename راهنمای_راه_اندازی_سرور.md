# راهنمای راه‌اندازی سرور WebSocket

## مشکل فعلی
سرور WebSocket در حال اجرا نیست، به همین دلیل قابلیت‌های real-time پروژه کار نمی‌کنند.

## راه‌حل‌های راه‌اندازی سرور

### روش 1: استفاده از npm run dev (توصیه می‌شود)
این دستور هم سرور و هم کلاینت را به‌صورت همزمان اجرا می‌کند:

```bash
npm run dev
```

### روش 2: اجرای جداگانه سرور
فقط سرور را اجرا کنید:

```bash
npm run dev:server
```

### روش 3: استفاده از tsx مستقیم
```bash
npx tsx watch src/server.ts
```

یا برای سرور با داده‌های واقعی:
```bash
npx tsx watch src/server-real-data.ts
```

## تنظیمات پورت

### پورت پیش‌فرض
- سرور اصلی (`server.ts`): پورت **8000**
- سرور داده واقعی (`server-real-data.ts`): پورت **3001**

### تغییر پورت
می‌توانید پورت را از طریق متغیر محیطی تغییر دهید:

```bash
# Windows PowerShell
$env:PORT=3001
npm run dev:server

# یا در یک خط
$env:PORT=3001; npm run dev:server
```

## بررسی وضعیت سرور

### 1. بررسی اینکه سرور در حال اجرا است
```powershell
netstat -ano | findstr ":3001"
# یا برای پورت 8000
netstat -ano | findstr ":8000"
```

### 2. تست Health Check
باز کردن در مرورگر:
- http://localhost:3001/api/health
- http://localhost:8000/api/health

یا با PowerShell:
```powershell
Invoke-WebRequest -Uri http://localhost:3001/api/health
```

### 3. تست WebSocket
WebSocket باید در این آدرس در دسترس باشد:
- ws://localhost:3001/ws
- ws://localhost:8000/ws

## مشکلات رایج و راه‌حل‌ها

### 1. پورت در حال استفاده است
```powershell
# پیدا کردن process که از پورت استفاده می‌کند
netstat -ano | findstr ":3001"

# کشتن process (PID را از خروجی بالا بگیرید)
taskkill /PID <PID> /F
```

### 2. خطای "Cannot find module"
```bash
npm install
```

### 3. خطای TypeScript
```bash
npm run build:server
```

## تنظیمات Frontend

مطمئن شوید که در فایل `.env` یا تنظیمات محیطی، مقادیر زیر درست تنظیم شده‌اند:

```env
VITE_API_BASE=http://localhost:3001
VITE_WS_BASE=ws://localhost:3001/ws
```

## قابلیت‌های WebSocket

پس از راه‌اندازی سرور، این قابلیت‌ها فعال می‌شوند:

1. **Real-time Price Updates**: به‌روزرسانی لحظه‌ای قیمت‌ها
2. **Live Signals**: سیگنال‌های زنده AI
3. **Market Data Streaming**: جریان داده‌های بازار
4. **Position Updates**: به‌روزرسانی موقعیت‌های معاملاتی
5. **Health Monitoring**: نظارت بر سلامت سیستم

## لاگ‌ها و دیباگ

برای مشاهده لاگ‌های دقیق‌تر:

```bash
# فعال‌سازی debug mode
$env:DEBUG="*"
npm run dev:server
```

## نکات مهم

1. ✅ همیشه مطمئن شوید که سرور قبل از استفاده از frontend در حال اجرا است
2. ✅ پورت‌های 3001 و 8000 باید آزاد باشند
3. ✅ firewall نباید مانع اتصال به localhost شود
4. ✅ در صورت تغییر پورت، تنظیمات frontend را هم به‌روز کنید

## دستورات سریع

```bash
# نصب وابستگی‌ها
npm install

# اجرای کامل (سرور + کلاینت)
npm run dev

# فقط سرور
npm run dev:server

# بررسی health
curl http://localhost:3001/api/health

# یا با PowerShell
Invoke-WebRequest -Uri http://localhost:3001/api/health
```

## پشتیبانی

اگر مشکل همچنان ادامه دارد:
1. لاگ‌های console سرور را بررسی کنید
2. لاگ‌های console مرورگر را بررسی کنید
3. مطمئن شوید که تمام وابستگی‌ها نصب شده‌اند
4. سرور را restart کنید

